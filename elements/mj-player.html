<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="base.html">
<link rel="import" href="mj-bonus.html">
<link rel="import" href="mj-set.html">
<link rel="import" href="mj-limit.html">

<polymer-element name="mj-player" extends="mj-base" attributes="name score wins wind east" score="-" wins="-" wind="-">

  <template>
    <link rel="stylesheet" href="style/mj-ui.css">
    <link rel="stylesheet" href="style/mj-player.css">

    <div id="playerinfo">
      <span class="wind{{wind}}">{{wind}}</span>
      <input type="text" id="name" value="{{name}}" placeholder="player name here">
      <span id="scoring">score: {{score}}/{{wins}}</span>
    </div>

    <mj-bonus id="bonus"></mj-bonus>

    <mj-set></mj-set>
    <mj-set></mj-set>
    <mj-set></mj-set>
    <mj-set></mj-set>
    <mj-set></mj-set>

    <button id="ninetile" disabled>nine tile error!</button>

    <button id="illegal" disabled>illegal win declaration!</button>

    <mj-limit id="limit"></mj-limit>
  </template>

  <script>
    Polymer("mj-player", {
      domReady: function() {
        var self = this;
        this.bonus = this.$.bonus;
        this.sets = this.find("mj-set");
        this.limit = this.$.limit;
      },
      reset: function(score, wind, resetwins) {
        if (arguments.length > 0) {
          this.set("score",score);
          this.set("wind",wind);
          this.set("wins",0);
        }
        this.bonus.reset();
        this.limit.reset();
        this.sets.forEach(function(set) { set.reset(); });
      },
      markEast: function() {
        this.set("east",true);
      },
      nextWind: function(direction) {
        this.adjust("wind", direction);
        if(this.wind<0) { this.set("wind", 3); }
        else if(this.wind>3) { this.set("wind", 0); }
      },
      getSets: function() {
        return this.sets.filter(function(s) { return !s.empty(); });
      },
      getBonus: function() {
        return this.bonus;
      },
      getLimit: function() {
        return this.limit.getLimit();
      },
      useRules: function(rules) {
        this.$.limit.useRules(rules);
      },
      getPoints: function(amount) {
        this.adjust("score", amount);
      },
      setHistory: function(track) {
        this.history = track;
      },
      recordHand: function(hand) {
        this.history.recordHand(hand);
      }
    });
  </script>

</polymer-element>
